# Flow Coverage Report

**Generated:** 2026-02-06
**Generated By:** QA Manager Agent
**Model:** Claude Opus 4.5
**Version:** 0.19.0

---

## Executive Summary

| Metric | Count | Percentage |
|--------|-------|------------|
| **Total Flows** | 45 | 100% |
| **Fully Covered (Good)** | 26 | 58% |
| **Partially Covered** | 15 | 33% |
| **Minimal/No Coverage** | 4 | 9% |

### Test Infrastructure
| Test Type | Files | Tests | Notes |
|-----------|-------|-------|-------|
| Unit Tests (web) | 38 | 407 | API routes, lib, adapters |
| Unit Tests (core) | 3 | 78 | PathFinder, entity resolution, scoring |
| Integration Tests | 2 | - | LinkedIn parser only |
| E2E Tests | 11 | 98 | Playwright specs |
| **Total** | **54** | **583** | |

---

## P0 Flows (Critical) - 8 Total

| Flow | Category | Unit | Integration | E2E | Status | Gap |
|------|----------|------|-------------|-----|--------|-----|
| Google OAuth Login | user | âŒ | âŒ | âœ… | Partial | Missing unit tests for token refresh |
| Session Validation | api | âŒ | âŒ | âœ… | Partial | No unit tests for withAuth helper |
| LinkedIn Archive Upload | user | âœ… | âŒ | âœ… | Good | - |
| LinkedIn Archive Process | user | âœ… | âœ… | âœ… | Good | - |
| Person Search | user | âœ… | âŒ | âœ… | Good | - |
| Pathfinding | user | âœ… | âŒ | âœ… | Good | Missing PathFinder unit tests |
| Multi-Tenant Isolation | system | âœ… | âŒ | âœ… | Good | - |
| Token Exposure Prevention | api | âœ… | âŒ | âœ… | Good | - |

**P0 Coverage: 6/8 Good (75%)**

---

## P1 Flows (Important) - 16 Total

| Flow | Category | Unit | Integration | E2E | Status |
|------|----------|------|-------------|-----|--------|
| User Logout | user | âŒ | âŒ | âœ… | Partial |
| LinkedIn Cron Process | system | âœ… | âŒ | âŒ | Partial |
| LinkedIn Job Status | api | âœ… | âŒ | âŒ | Partial |
| LinkedIn Inngest Process | system | âœ… | âŒ | âŒ | Partial |
| Gmail Sync Cron | system | âœ… | âŒ | âœ… | Partial |
| Gmail Connection Status | user | âœ… | âŒ | âœ… | Good |
| Person Detail | api | âœ… | âŒ | âŒ | Good |
| Network Overview | api | âœ… | âŒ | âœ… | Good |
| Connections List | api | âœ… | âŒ | âœ… | Good |
| Click to Graph | user | âŒ | âŒ | âœ… | Good |
| Evidence Fetch | api | âœ… | âŒ | âŒ | Partial |
| Relationship Scoring | system | âŒ | âœ… | âŒ | Partial |
| Data Sources List | api | âœ… | âŒ | âœ… | Good |
| Health Check | api | âœ… | âŒ | âŒ | Good |
| Readiness Probe | api | âœ… | âŒ | âŒ | Good |
| Current User Profile | api | âœ… | âŒ | âŒ | Good |

**P1 Coverage: 10/16 Good (63%)**

---

## P2 Flows (Medium) - 12 Total

| Flow | Category | Unit | Integration | E2E | Status |
|------|----------|------|-------------|-----|--------|
| Auth Error Handling | user | âŒ | âŒ | âœ… | Good |
| LinkedIn Upload History | api | âœ… | âŒ | âœ… | Partial |
| LinkedIn Profile Fetch | api | âœ… | âŒ | âŒ | Minimal |
| Data Source Create/Update | api | âœ… | âŒ | âŒ | Partial |
| Data Source CRUD by ID | api | âœ… | âŒ | âŒ | Partial |
| Admin LinkedIn Jobs | api | âœ… | âŒ | âŒ | Partial |
| Inngest Contacts Ingested | system | âœ… | âŒ | âŒ | Minimal |
| Inngest Interactions | system | âœ… | âŒ | âŒ | Minimal |
| Inngest Entities Merged | system | âœ… | âŒ | âŒ | Minimal |
| Inngest Graph Updated | system | âœ… | âŒ | âŒ | Minimal |
| Inngest Sync Events | system | âœ… | âŒ | âŒ | Minimal |
| Database Seed | api | âœ… | âŒ | âŒ | Partial |

**P2 Coverage: 2/12 Good (17%)**

---

## P3 Flows (Low) - 9 Total

| Flow | Category | Unit | Integration | E2E | Status |
|------|----------|------|-------------|-----|--------|
| Admin LinkedIn Cleanup | api | âœ… | âŒ | âŒ | Partial |
| Admin Archive Inspection | api | âœ… | âŒ | âŒ | Minimal |
| Debug Endpoint | api | âœ… | âŒ | âŒ | Minimal |
| Debug LinkedIn | api | âœ… | âŒ | âŒ | Minimal |
| GitHub Issues | api | âœ… | âŒ | âŒ | Partial |
| Changelog | api | âœ… | âŒ | âŒ | Partial |

**P3 Coverage: 0/9 Good (0%)** - Acceptable for low priority

---

## Critical Gaps (Action Required)

### 1. Security Gaps ğŸ”´
| Gap | Impact | Status |
|-----|--------|--------|
| Admin endpoints lack authentication | HIGH | âš ï¸ Still needs work |
| withAuth helper has no unit tests | MEDIUM | âœ… FIXED - 12 tests added |

### 2. Missing Unit Tests ğŸŸ¡
| Component | Location | Status |
|-----------|----------|--------|
| PathFinder class | packages/core/src/pathfinding.ts | âœ… FIXED - 19 tests |
| LinkedInRelationshipScorer | packages/core/src/scoring/linkedin-scorer.ts | âš ï¸ Needs integration tests |
| Base scorer | packages/core/src/scoring/base-scorer.ts | âœ… FIXED - 30 tests |
| Entity resolution | packages/core/src/entity-resolution.ts | âœ… FIXED - 29 tests |

### 3. Missing Integration Tests ğŸŸ¡
| Component | Priority | Status |
|-----------|----------|--------|
| Gmail API adapter | P1 | âš ï¸ Needs work |
| LinkedIn API adapter | P1 | âš ï¸ Needs work |
| Graph service with real DB | P2 | âš ï¸ Needs work |

### 4. Missing E2E Tests ğŸŸ¡
| Flow | Priority | Status |
|------|----------|--------|
| Evidence display in UI | P1 | âœ… FIXED - 3 tests |
| Person detail view | P1 | âœ… FIXED - 7 tests |
| Source filter integration | P1 | âœ… FIXED - 1 test |
| Error handling flows | P2 | âš ï¸ Needs work |

### 5. Placeholder Implementations ğŸŸ 
| Component | Status | Priority |
|-----------|--------|----------|
| Inngest event handlers | Placeholder | P2 |
| Entity resolution | âœ… Core logic tested | P2 |

---

## Coverage by Test Type

### Unit Test Coverage
```
API Routes:      29/30 have tests (97%)
Lib utilities:    3/8 have tests (38%)  <- GAP
Core package:     0/4 modules tested    <- GAP
Adapters:         2/5 modules tested    <- Partial
```

### Integration Test Coverage
```
LinkedIn Parser: âœ… Full coverage
Gmail Adapter:   âŒ No tests
LinkedIn API:    âŒ No tests
Graph Service:   âŒ No tests
```

### E2E Test Coverage
```
Authentication:     âœ… Covered
Data Sources:       âœ… Covered
LinkedIn Import:    âœ… Covered
Gmail Integration:  âœ… Covered
Search:             âœ… Covered
Pathfinding:        âœ… Covered
Privacy Controls:   âœ… Covered
Click to Graph:     âœ… Covered
```

---

## Recommendations (Priority Order)

### Immediate (This Sprint)
1. **Add auth to admin endpoints** - Security risk
2. **Add PathFinder unit tests** - P0 flow, core functionality
3. **Add withAuth helper tests** - Used by all protected routes

### Short Term (Next Sprint)
4. Add LinkedInRelationshipScorer tests
5. Add Gmail API integration tests
6. Add E2E tests for evidence display

### Medium Term
7. Implement Inngest event handlers properly
8. Add comprehensive error flow E2E tests
9. Add graph service integration tests

---

## Flow Registry Location

Full flow definitions with all details: `docs/qa/FLOW-REGISTRY.yaml`

---

## Next QA Manager Tasks

1. [ ] Weekly: Regenerate this report after test additions
2. [ ] Review all new PRs for flow coverage requirements
3. [ ] Update FLOW-REGISTRY.yaml when new flows are added
4. [ ] Track test execution times and flakiness
5. [ ] Maintain test requirements documentation
